<!DOCTYPE html>
<html lang="ko" xmlns:th="http://thymeleaf.org">
<html>
	<head>
		<meta charset="UTF-8">
		<title>주류정보 업데이트</title>
		<link rel="stylesheet" href="/css/liquor/liquorUpdate.css">
		<script src="/js/liquor/liquorUpdate.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
		<style type="text/css">
			/* 리스트 아이템을 클릭 가능하게 보이도록 스타일 추가 */
			.clickable-brewery {
			    color: blue; /* 파란색으로 텍스트 색상 변경 */
			    cursor: pointer; /* 마우스를 가져다 대면 커서가 클릭 모양으로 변경 */
			    text-decoration: underline; /* 링크처럼 밑줄 추가 */
			}
			
			/* 마우스를 가져다 댔을 때의 추가 스타일 (선택 사항) */
			.clickable-brewery:hover {
			    color: darkblue; /* 마우스를 올렸을 때 더 진한 파란색으로 변경 */
			}
		</style>
	</head>
	<body>
		<h1>주류정보 업데이트</h1>
		<form action="/liquor/update" method="post" th:object=${liquor} enctype="multipart/form-data">
			<input type="hidden" name="liquorId" th:value="*{liquorId}">
			상품명 <input type="text" name="liquorName" th:value="*{liquorName}"> <br>
			알콜도수 <input type="number" step="0.01" name="alcholContent" th:value="*{alcholContent}"> <br>
			주종 
			<select name="liquorType" th:field="*{liquorType}">
				<option value="전통주">전통주</option>
				<option value="막걸리">막걸리</option>
				<option value="청주">청주</option>
				<option value="소주">소주</option>
				<option value="와인">와인</option>
				<option value="위스키">위스키</option>
				<option value="맥주">맥주</option>
				<option value="리큐르">리큐르</option>
				<option value="브랜디">브랜디</option>
				<option value="브랜디">브랜디</option>
				<option value="보드카">보드카</option>
			</select> <br>
			가격 <input type="number" name="liquorPrice" th:value="*{liquorPrice}"> <br>
			용량 <input type="number" name="liquorCapacity" th:value="*{liquorCapacity}"> <br>
			양조장ID <input type="number" name="breweryId" id="breweryId" required>
					 <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#brewerySearchModal">검색</button> <br>
			이미지 첨부 <input type="file" name="files" multiple /> <br>
			<input type="submit" value="변경">
		</form>
		
		<!-- 모달 창 -->
		<div class="modal fade" id="brewerySearchModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
		    <div class="modal-dialog">
		        <div class="modal-content">
		            <div class="modal-header">
		                <h5 class="modal-title" id="exampleModalLabel">양조장 검색</h5>
		                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		            </div>
		            <div class="modal-body">
		                <form id="modalForm">
		                    <div class="mb-3">
		                    	<!-- input-group 사용 -->
		                    	<div class="input-group">
			                        <input type="text" class="form-control" id="nameInput" placeholder="양조장 이름">
			                        <button type="button" class="btn btn-primary" id="searchData">검색</button>
		                    	</div>
		                    </div>
		                    <div class="mb-3">
		                        <!-- 리스트 출력 영역 -->
		                    </div>
		                </form>
		            </div>
		            <div class="modal-footer">
		                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
		            </div>
		        </div>
		    </div>
		</div>
		
		<!-- Bootstrap JS and dependencies -->
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
		<!-- JavaScript 코드 -->
		<script>
			document.getElementById('searchData').addEventListener('click', function () {
				brewerySearch();
			});
			
			document.getElementById('modalForm').addEventListener('submit', function(event) {
			    event.preventDefault(); // form 제출 방지
			    brewerySearch(); // 검색 실행
			});
			
			document.getElementById('nameInput').addEventListener('keyup', function (event) {
			    if (event.key === 'Enter') { 	// Enter 키가 눌렸는지 확인
			    	brewerySearch(); 			// Enter 키 입력 시 검색 수행
			    }
			});
			
			function brewerySearch(){
				let breweryName = document.getElementById('nameInput').value;
				
			    // AJAX 호출로 입력한 양조장 이름을 Spring Boot 컨트롤러로 전송
			    fetch('/liquor/searchBrewery', {
			        method: 'POST',
			        headers: {
			            'Content-Type': 'application/json',
			        },
			        body: JSON.stringify({ name: breweryName }), // 양조장 이름을 JSON 형태로 전송
			    })
			    .then(response => response.json()) // 서버로부터 JSON 형식의 데이터를 받음
			    .then(data => {
			        // 리스트 출력 영역을 클리어한 후 새로운 데이터로 업데이트
			        let resultArea = document.querySelector('.mb-3:nth-of-type(2)'); // 리스트 출력 영역
			        resultArea.innerHTML = ''; // 기존 내용 초기화
			        let breweryIdInput = document.getElementById('breweryId'); // id가 breweryId인 input 태그를 가져옴
	
			        data.forEach(brewery => {
			            let listItem = document.createElement('div');
			            listItem.textContent = brewery.breweryName; // 받아온 양조장 이름을 표시
			            
			         	// 리스트 아이템에 스타일 클래스 추가
			            listItem.classList.add('clickable-brewery');
	
			            // 클릭 시 brewery.breweryNo 값을 input 태그의 value에 넣음
			            listItem.addEventListener('click', function() {
			                breweryIdInput.value = brewery.breweryNo; // breweryNo 값을 input 태그에 설정
			                
			                let modalInstance = bootstrap.Modal.getInstance(brewerySearchModal);
			                modalInstance.hide(); // 모달 창 닫기
			            });
	
			            resultArea.appendChild(listItem);
			        });
			    })
			    .catch(error => {
			        console.error('Error:', error);
			    });
			}
		</script>
		
	</body>
</html>
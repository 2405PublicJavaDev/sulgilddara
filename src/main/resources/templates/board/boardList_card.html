<!DOCTYPE html>
<html xmlns:th="http://thymeleaf.org" >
	<head>
		<meta charset="UTF-8">
		<title>술 이야기 메인</title>
		<script src="https://kit.fontawesome.com/7d4169cb69.js" crossorigin="anonymous"></script>
		<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700&display=swap" rel="stylesheet">
		<link rel="stylesheet" href="../css/board/header.css">
		<link rel="stylesheet" href="../css/board/boardPage.css">
		<link rel="stylesheet" href="../css/board/footer.css">
		
		<style type="text/css">
			*{
				box-sizing: border-box;
			}
			
			
	        
	        .container {
	            max-width: 1800px;
	            margin: 0 auto;
	            background-color: white;
	            padding: 20px;
	            border-radius: 8px;
	            box-shadow: 0 0 10px rgba(0,0,0,0.1);
	            max-width: 1800px;
	        }
/* 	        .search-bar { */
/* 	            display: flex; */
/* 	            margin-bottom: 20px; */
/* 	        } */
/* 	        .search-bar input[type="text"] { */
/* 	            flex-grow: 1; */
/* 	            padding: 10px; */
/* 	            border: 1px solid #ddd; */
/* 	            border-radius: 4px 0 0 4px; */
/* 	        } */
/* 	        .search-bar button { */
/* 	            padding: 10px 20px; */
/* 	            background-color: #b8860b; */
/* 	            color: white; */
/* 	            border: none; */
/* 	            border-radius: 0 4px 4px 0; */
/* 	            cursor: pointer; */
/* 	        } */
	        .tag-list {
	            display: flex;
	            flex-wrap: wrap;
	            gap: 10px;
	            margin-bottom: 20px;
	        }
	        .tag {
	            background-color: #f8f8f8;
	            border: 1px solid #ddd;
	            border-radius: 20px;
	            padding: 5px 15px;
	            font-size: 14px;
	            color: #333;
	        }
	        .view-options {
	            display: flex;
	            justify-content: space-between;
	            align-items: center;
	            margin-bottom: 20px;
	        }
	        .view-type a {
	            margin-right: 10px;
	            text-decoration: none;
	            color: #333;
	        }
	        .sort-select select {
	            padding: 5px;
	        }
	        .review-grid {
	            display: grid;
	            /* 각 열의 최소 너비를 250픽셀로 설정합니다. */
				/* 각 열의 최대 너비를 가용 공간에 따라 비율적으로 설정합니다. 즉, 가용 공간이 많을수록 열이 커지며, 모든 열이 동일한 비율로 공간을 나눕니다. */
	            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); 

	            gap: 20px;
	        }
	        .review-card{
	        	transition: all 0.2s ease;
	        	cursor:pointer;	
	        	height: 600px;
	        }
	        .review-card a{
	        	color: black;	 
	        	height: 100%;       	
	        }
	        
	        
	        .review-card:hover {
	            border-radius: 8px;
	            overflow: hidden;
			    transform: translate(0px,-5px);
			    box-shadow: 0px 5px 5px 5px rgb(162, 162, 162);
	        }
	        .boardOne{
	        	display: flex;
	        	flex-direction: column;
	        	height: 100%;
	        	
	        }
	        
	        
	        .review-header {
	        	width:100%;
	        	height:100px;
	            background-color: #f8f8f8;
	            display: flex;
	            justify-content: space-between;
	            padding: 0 10px;
	        }
	        .review-content{
	        	width:100%;
	        	
				flex-grow: 1;
	        }
	        
			h3{
				margin: 10px 0; 
				max-width:200px; 
			}
	        
	        .review-footer {
	            background-color: #f8f8f8;
	            padding: 0 10px;
	            display: flex;
	            flex-direction: column;
	            font-size: 16px;
 	        } 
 	        
 	        

	        
	        .thumbnail{
	        	width: 100%;
	        	height: 300px;
	        	background-color: black;
	        }
	        .contentDiv-text{
	        	width: 100%;
	        	height: 150px;
	        	padding: 10px;
	        }
	        .starContainer{
	        	color: #fdc82a;
	        	width: 120px;
	        }
	        
	        .starContainer i{
	        	font-size: 20px;
	        	line-height: 45px;
	        }
	        
	        #searchCondition{
	        	border-radius: 5px;
	        	width: 80px;
	        	height: 100%;
	        	border: 3px solid #735747;
	        	color: #735747;
	        	font-size: 15px;
	        	font-weight: 1000;
	        	
	        }
	        #searchFormBar{
	        	height: 60px;
	        }
	        
	        #searchBar{
	        	width: 100%;
	        	height: 100%;
 	        	border-radius: 30px;
	        	padding: 0px;
	        	border: 3px solid #735747;
	        }
	        
	        #searchBtn-keyword{
	        	border-radius:50%;
	        	padding: 0px;
	        	width: 60px;
	        	height: 60px;
	        	color: white;
	        	background-color:#735747;
	        	border: 0px;
	        	font-size: 25px;
	        	cursor: pointer;
	        }
	        
	        #searchBarContainer{
	        	margin:0 auto;
	        	width:80%;
	        	display: flex;
	        	justify-content: center;
	        	height: 100%;
	        }
	       
	       
	        
	        #tagListContainer{
	        	display: flex;
	        	flex-wrap: wrap;
	        	width: 80%;
	        	margin: 0 auto;
	        	margin-top: 20px;
	        	gap:8px;
	        	position: relative;
	        }
	        
	        #searchButton{
	        	width: 80px;
	        	height: 50px;
	        	font-size: 16px;
	        	font-weight:1000;
	        	border-radius: 10px;
	        	background-color: #735747;
				color: white;
				border: 0px;
				position: absolute;
				left: 100%;
				top: 0px;
				cursor: pointer;
	        }
	        #searchButton:disabled {
	        	color: gray;
	        	background: rgb(221, 208, 190);
	        	border: 0px;
			}
			
			label{
	       		user-select:none;
	       		font-size: 18px;
	       		font-weight: bold;
				display: inline-block;
				padding: 8px;
	       		background-color: rgb(221, 208, 190);
	       		color: #735747;
				border-radius: 10px;
				cursor: pointer;
				transition: all 0.2s
	       }
	       
	        label:hover{
				background-color: #735747;
				color: white;
	       		transform:scale(1.1);
	       }
	       
	       .tagCheckBox:checked + label{
				background: #735747;
				color: white;
				transform:scale(1.1);
			}
			
			#writePageLink{
				display:block;
				color: white;
				font-size: 18px;
				font-weight:1000;
				text-decoration: none;
				width: 80px;
				height: 50px;
				background-color: #bf4539;
				text-align: center;
				border-radius: 10px;
				line-height: 50px;
			}
			.sort-select{
				position: relative;
				height: 50px;
			}
			#orderSelectBox{
				border-radius: 5px;
	        	width: 80px;
	        	height: 40px;
	        	border: 3px solid #735747;
	        	color: #735747;
	        	font-size: 15px;
	        	font-weight: 1000;
	        	position: absolute;
	        	top: 0px;
	        	right: 0px;
			}
			.paginationBox a{
				display:inline-block;
				text-align:center;
				line-height:30px;
				font-size: 20px;
				min-width:30px;
				height:30px;
				text-decoration: none;
				color: #333;
			}
			.paginationBox #currentPageId{
				display:inline-block;
				text-align:center;
				line-height:30px;
				font-size: 20px;
				min-width:30px;
				height:30px;
				text-decoration: none;
				border-radius:50%;
				background-color:#bf4539;
				color: white;
			}
			
			.paginationBox{
				text-align: center; 
				height: 120px;
				line-height: 120px;
			}

			
		</style>
		
<!-- 		<span th:text="${#strings.length(board.title) > 10 ? board.title.substring(0, 10) + '...' : board.title}"></span> -->
		
	</head>
	<body>
		<header>
        <div class="header-top">
            <div style="width: 100px;;"></div>
            	<a href="/" class="logo-link">
	            <div id="logo-container">
	                <img src="/img/logo.png" alt="로고" id="logo">
		            <h1>술길따라</h1>
	            </div>
            	</a>
            <div class="user-actions">
	            <div class="dropdown" th:if="${session.userId != null}">
        			<a href="#" class="icon-user" id="userMenuToggle">
            			<img class="header-img" src="/img/free-icon-user-17095347.png" alt="사용자 아이콘">
        			</a>
        			<div class="mypage-content" id="mypageDropdown">
        				<span class="user-name" th:text="${session.userName} + '님'"></span>
        					<hr>
            			<a href="/user/update">마이페이지</a>
            			<a href="/user/logout">로그아웃</a>
        			</div>
    			</div>
    			<div th:if="${session.userId == null}">
    				<a href="/user/login" class="icon-user">
	                	<img class="header-img" src="/img/free-icon-user-17095347.png" alt="">
	                </a>
	            </div>
               	<a href="#" class="icon-menu">
                	<img class="header-img" src="/img/free-icon-menu-3856832.png" alt="">
                </a>
            </div>
        	</div>
        <nav>
            <ul>
                <li><a href="#story">술길따라 이야기</a></li>
                <li><a href="/brewery/">양조장 탐방</a></li>
                <li><a href="/liquor/search">술 도감</a></li>
                <li><a href="/reservation/list">투어 예약</a></li>
                <li><a href="/board/listCard">술 이야기</a></li>
            </ul>
        </nav>
    </header>
<!-- 		<div> -->
<!-- 			<span>카드형</span> -->
<!-- 			<a href="/board/listTable">목록형</a> -->
<!-- 		</div> -->
		<div class="container">
		
		
		<div>
			<a id="writePageLink" th:href="@{/board/writePage}" th:text="'글 등록'"></a>
		</div>
	<form id="searchFormBar" action="/board/listCard" method="post">
		<input type="hidden" name="searchMethod" value="keywordSearch">
		
		<div id="searchBarContainer">
			 <select id="searchCondition" name="searchCondition">
			 	<option value="all" th:selected="${searchCondition eq 'all'}">전체</option>
			    <option value="boardSubject" th:selected="${searchCondition eq 'boardSubject'}">제목</option>
			    <option value="boardWriter" th:selected="${searchCondition eq 'boardWriter'}">작성자</option>
			 </select>
			 
			 <div style="position: relative; width: 100%">
				<input id="searchBar" type="text" name="searchKeyword" th:value="${searchKeyword}">
				<div style="position: absolute; top: 0px; left: 100%; transform: translateX(-50%);">
					<button id="searchBtn-keyword"><i class="fa-solid fa-magnifying-glass"></i></button>
				</div>
			 </div>
		</div>
		
			 <!-- 정렬 선택 hidden input -->
		<input type="hidden" id="orderInputHidden_default"  name="orderSelectBox" th:value="${orderSelectBox}">
	</form>
	
	<div>
		<form action="/board/searchTag_listCard" method="post">
			<input type="hidden" name="searchMethod" value="tagSearch">
			<div id="tagListContainer">
				<button type="submit" id="searchButton" disabled>간편검색</button>
				<div th:each="tag : ${bTagListDistinct}">
					<input style="opacity: 0; width: 0px;" type="checkbox" class="tagCheckBox" th:name="tagName" th:value="${tag.boardTagName}" th:id="${tag.boardTagName}" th:checked="${selectedTags != null && #strings.contains(selectedTags, tag.boardTagName)}">
					<label th:for="${tag.boardTagName}"># [[${tag.boardTagName}]]</label>		
				</div>
			</div>
			
<!-- 			체크하지 않았을땐 비활성화(default) -->
<!-- 			정렬 선택 hidden input -->
			<input type="hidden" id="orderInputHidden_tag"  name="orderSelectBox" th:value="${orderSelectBox}">
		</form>
	</div>


<!-- 		정렬 선택 -->
	<div class="sort-select">
		<select name="orderSelectBox" id="orderSelectBox" onchange="updateHiddenValue();">
			<option value="latest" th:selected="${orderSelectBox eq 'latest'}">최신순</option>
			<option value="viewCount" th:selected="${orderSelectBox eq 'viewCount'}">조회순</option>
			<option value="boardPoint" th:selected="${orderSelectBox eq 'boardPoint'}">별점순</option>
		</select>
	</div>
		
		
	<div th:if="${#lists.isEmpty(bList)}">
			<div>NoData</div>
			<a th:href="@{/board/listCard(cp=${p},boardSubject=${boardSubject})}">처음으로</a>
 	</div>	
	
	<div class="review-grid">
		<div class="review-card"  th:if="${!#lists.isEmpty(bList)}" th:each="board : ${bList}">
					<a style="display: block; text-decoration: none" th:href="@{/board/detailPage/{boardNo}/{viewStatus}(boardNo=${board.boardNo}, viewStatus='yes')}">
						<div class="boardOne">
							<div class="review-header">
			                    <h3 th:text="'['+${board.liquorName}+'] '+${#strings.length(board.boardSubject) > 15 ? board.boardSubject.substring(0, 15) + ' . . .' : board.boardSubject}"></h3>
			                    
			                    
				                    <div class="starContainer" th:if="${board.boardPoint == 0.5}"><i class="fa-solid fa-star-half"></i></div>
				                    <div class="starContainer"  th:if="${board.boardPoint == 1}"><i class="fa-solid fa-star"></i></div>
				                    <div class="starContainer"  th:if="${board.boardPoint == 1.5}"><i class="fa-solid fa-star"></i><i class="fa-solid fa-star-half"></i></div>
				                    <div class="starContainer"  th:if="${board.boardPoint == 2}"><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i></div>
				                    <div class="starContainer"  th:if="${board.boardPoint == 2.5}"><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star-half"></i></div>
				                    <div class="starContainer"  th:if="${board.boardPoint == 3}"><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i></div>
				                    <div class="starContainer"  th:if="${board.boardPoint == 3.5}"><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star-half"></i></div>
				                    <div class="starContainer"  th:if="${board.boardPoint == 4}"><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i></div>
				                    <div class="starContainer"  th:if="${board.boardPoint == 4.5}"><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star-half"></i></div>
				                    <div class="starContainer"  th:if="${board.boardPoint == 5}"><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i></div>
				                    
		                	</div>
					
	                	
						<div class="review-content">
							<div th:each="bFile : ${bFileList}"  th:if="${bFile.boardNo == board.boardNo}">
								<div class="thumbnail" th:style="'background-image: url('+ ${bFile.boardFilePath}+${bFile.boardFileRename} + ');background-position: center;background-size: cover;background-repeat: no-repeat; '"></div>
							</div>
							
		                    <div th:utext="${#strings.length(board.boardContent) > 80 ? board.boardContent.substring(0, 80) + '...' : board.boardContent}" class="contentDiv-text"></div>
		                    <div style="padding: 0 10px">
		                		<span style="margin-right:10px;" th:text="${#dates.format(board.boardDate, 'yyyy년 MM월 dd일')}"></span>
		                		
		                		<span th:text="'댓글 총 0개'"></span>
		                    </div>
	                	</div>
	                	
	                	
						
	                	<div class="review-footer">
	                		
		                    
							<div id="bTagList">
								<span style="font-weight: 800;" th:each="tag : ${bTagList}" th:if="${tag.boardNo == board.boardNo}">#[[${tag.boardTagName}]] </span>
							</div>
							<div style="display: flex; justify-content: space-between;">
								<span style="color: gray" th:text="'by '+${board.userId}"></span>
			                    <span th:text="'조회수: ' + ${board.viewCount}"></span>
							</div>
	                	</div>
	                	
		<!-- 				프로필사진, 회원ID,  -->
		
					</div>
				</a>
		</div>
		
	</div>
	
	<!-- 	키워드 검색 - 페이징네비 -->
	<div class="paginationBox" th:unless="${#lists.isEmpty(bList)}" th:if="${searchMethod == 'keywordSearch'}">
		<div>
			<a th:if="${pn.currentPage != 1}"  th:href="@{/board/listCard(cp=1, searchMethod=${searchMethod},  searchCondition=${searchCondition}, searchKeyword=${searchKeyword}, orderSelectBox=${orderSelectBox})}">처음</a>
			<a th:if="${pn.getStartNavi() != 1}"  th:href="@{/board/listCard(cp=${pn.prevPage}, searchMethod=${searchMethod},  searchCondition=${searchCondition}, searchKeyword=${searchKeyword}, orderSelectBox=${orderSelectBox})}">이전</a>
			<span th:each="p : ${#numbers.sequence(pn.startNavi, pn.endNavi)}">
				<span th:if="${p == pn.currentPage}">
					<span id="currentPageId">
						[[${p}]]
					</span>
				</span>
				<span th:if="${p != pn.currentPage}">
					<a th:href="@{/board/listCard(cp=${p}, searchMethod=${searchMethod},  searchCondition=${searchCondition}, searchKeyword=${searchKeyword}, orderSelectBox=${orderSelectBox})}" th:text="${p}"></a>			
				</span>
			</span>
			<a th:if="${pn.getEndNavi() != pn.getMaxPage()}" th:href="@{/board/listCard(cp=${pn.nextPage}, searchMethod=${searchMethod},  searchCondition=${searchCondition}, searchKeyword=${searchKeyword}, orderSelectBox=${orderSelectBox})}">다음</a>
			<a th:if="${pn.currentPage != pn.maxPage}"  th:href="@{/board/listCard(cp=${pn.maxPage}, searchMethod=${searchMethod},  searchCondition=${searchCondition}, searchKeyword=${searchKeyword}, orderSelectBox=${orderSelectBox})}">마지막</a>
		</div>
	</div>
	
<!-- 	간편검색 - 페이징네비 -->
	<div class="paginationBox" th:unless="${#lists.isEmpty(bList)}" th:if="${searchMethod == 'tagSearch'}">
		<div>
			<a th:if="${pn.currentPage != 1}"  href="javascript:void(0)" th:text="처음" th:onclick="navigateWithTags(1)"></a>
			<a th:if="${pn.getStartNavi() != 1}"  href="javascript:void(0)" th:text="이전" th:onclick="navigateWithTags([[${pn.prevPage}]])"></a>
			
			
			<span th:each="p : ${#numbers.sequence(pn.startNavi, pn.endNavi)}">
				<span th:if="${p == pn.currentPage}">
					<span>
						[[${p}]]
					</span>
				</span>
				<span th:if="${p != pn.currentPage}">
					<a href="javascript:void(0)" th:text="${p}" th:onclick="navigateWithTags([[${p}]])"></a>
				</span>
			</span>
			<a th:if="${pn.getEndNavi() != pn.MaxPage}"  href="javascript:void(0)" th:text="다음" th:onclick="navigateWithTags([[${pn.nextPage}]])"></a>
			<a th:if="${pn.currentPage != pn.maxPage}"  href="javascript:void(0)" th:text="마지막" th:onclick="navigateWithTags([[${pn.maxPage}]])"></a>
			
		</div>
	</div>
		
		</div>
		<footer>
	        <nav>
	            <a href="#">이용약관</a> |
	            <a href="#">개인정보처리방침</a> |
	            <a href="#">사이트맵</a>
	        </nav>
	        <div class="company-info">
	            <p>상호 : 술길따라 | 대표이사 : 김정욱 | 설립일 : 2024년 8월 26일 | 개인정보관리책임자 : 홍예은</p>
	            <p>문의 : jwkim@gmail.com | 사업자등록번호 : 111-22-33333 | 서울시 중구 남대문로 120</p>
	        </div>
	        <div class="social-icons">
	            <a href="#" class="icon-facebook"><img src="./img/free-icon-facebook-circular-logo-20673.png" alt=""></a>
	            <a href="#" class="icon-instagram"><img src="./img/free-icon-instagram-4922972.png" alt=""></a>
	        </div>
	        <p class="copyright">Copyright 2024 Sulgilddara Inc. | All Rights Reserved</p>
	    </footer>
	
	
	
	</body>
	
	<script th:inline="javascript">
		document.addEventListener("DOMContentLoaded", function() {
			
	        let contentDivText = document.querySelectorAll(".contentDiv-text");
	        
	        // 텍스트만 출력하기
	        contentDivText.forEach(item => {
	    		item.innerHTML = item.textContent;
	        });
	        
	        
// 	        contentDivImg.forEach(item => {
// 	        	item.innerHTML = item.innerHTML.replace(/<(?!\/?img\b)[^>]*>/gi, ''); // replace(/<\/?[^img][^>]*>/g, '')  // <img> 태그 외의 모든 태그 제거
//  //	        	item.textContent = "";
// 	        	// div 내의 모든 자식 노드를 순회합니다.
			   
// 	        });
		
	// 		간편 검색 - 체크박스 아무것도 체크 안할 때 검색 버튼 비활성화
			let searchButton = document.querySelector("#searchButton");
			let tagCheckBox = document.querySelectorAll(".tagCheckBox");
			
			function updateSearchButtonStatus(){
	// 			Array.from()을 이용해 NodeList를 실제 스크립트 배열로 바꿔줌
	// 			배열의 내장 객체 some() 을 이용하여 조건을 만족시키면 true, 아니면 false를 반환
				let anyChecked = Array.from(tagCheckBox).some(checkBox => checkBox.checked);
				searchButton.disabled = !anyChecked;
			}
			
			tagCheckBox.forEach(checkBox => {
				checkBox.addEventListener('change', updateSearchButtonStatus);
			})
			updateSearchButtonStatus();
			
			
			// 정렬 선택 박스 change 시 hidden input 태그 value 변경
	        
	    });
		
		function updateHiddenValue(){
			const orderSelectBox = document.querySelector('#orderSelectBox');
			const hiddenInput_default = document.querySelector('#orderInputHidden_default');
			const hiddenInput_tag = document.querySelector('#orderInputHidden_tag');
			hiddenInput_default.value = orderSelectBox.value;
			hiddenInput_tag.value = orderSelectBox.value;
			
			console.log(hiddenInput_tag.value);
		}
		
		updateHiddenValue();
		
		function navigateWithTags(page) {
		    const selectedTags = [];
		    // 체크된 체크박스의 값을 배열에 추가
		    document.querySelectorAll('input[name="tagName"]:checked').forEach((checkbox) => {
		        selectedTags.push(checkbox.value);
		    });
		    // orderSelectBox 값을 가져오기
		    const orderSelectBox = document.getElementById('orderSelectBox').value;
		    
		    // URL 생성
		    let url = `/board/searchTag_listCard?cp=${page}&searchMethod=tagSearch&orderSelectBox=${orderSelectBox}`;
		    // 선택된 태그들을 URL에 추가
		    if (selectedTags.length > 0) {
		        url += '&tagName=' + selectedTags.join(',');
		    }
		    
		    // 페이지 이동
		    window.location.href = url;
		}

		
		
		</script>
</html>
<!DOCTYPE html>
<html xmlns:th="http://thymeleaf.org" >
	<head>
		<meta charset="UTF-8">
		<title>게시글 작성</title>
		<!-- include libraries(jQuery, bootstrap) -->
		<link href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet">
		<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
		
		<!-- include summernote css/js -->
		<link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css" rel="stylesheet">
		<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.js"></script>
	
		<!-- 태그 라이브러리 다운-->
		<!-- 소스 다운 -->
		<script src="https://unpkg.com/@yaireo/tagify"></script>
		<!-- 폴리필 (구버젼 브라우저 지원) -->
		<script src="https://unpkg.com/@yaireo/tagify/dist/tagify.polyfills.min.js"></script>
		<link href="https://unpkg.com/@yaireo/tagify/dist/tagify.css" rel="stylesheet" type="text/css" />	
	</head>
	<body>
		<h1>공지사항 등록</h1>
		<form action="/board/write" method="post" enctype="multipart/form-data">
			제목 <input type="text" name="boardSubject"> <br>
			태그 <input type="text" name="boardTagName" placeholder="#해쉬태그"> <br>
			내용 
			<div class="post-form">
				<textarea name="boardContent" id="summernote">
				</textarea>
			</div>
			
			<button>등록</button>
		</form>
		
		<script>
			$('#summernote').summernote({
				  // 에디터 크기 설정
				  height: 200,
				  // 에디터 한글 설정
				  lang: 'ko-KR',
				  // 에디터에 커서 이동 (input창의 autofocus라고 생각하시면 됩니다.)
				  toolbar: [
					    // 글자 크기 설정
					    ['fontsize', ['fontsize']],
					    // 글자 [굵게, 기울임, 밑줄, 취소 선, 지우기]
					    ['style', ['bold', 'italic', 'underline','strikethrough', 'clear']],
					    // 글자색 설정
					    ['color', ['color']],
					    // 표 만들기
					    ['table', ['table']],
					    // 서식 [글머리 기호, 번호매기기, 문단정렬]
					    ['para', ['ul', 'ol', 'paragraph']],
					    // 줄간격 설정
					    ['height', ['height']],
					    // 이미지 첨부
					    ['insert',['picture']]
					  ],
					  // 추가한 글꼴
					fontNames: ['Arial', 'Arial Black', 'Comic Sans MS', 'Courier New','맑은 고딕','궁서','굴림체','굴림','돋음체','바탕체'],
					 // 추가한 폰트사이즈
					fontSizes: ['8','9','10','11','12','14','16','18','20','22','24','28','30','36','50','72','96'],
			        // focus는 작성 페이지 접속시 에디터에 커서를 위치하도록 하려면 설정해주세요.
					focus : false,
			        // callbacks은 이미지 업로드 처리입니다.
					callbacks : {                                                    
						onImageUpload : function(files, editor) {   // 매개변수 welEditable 제외시킴.
			                // 다중 이미지 처리를 위해 for문을 사용했습니다.
							for (var i = 0; i < files.length; i++) {
								imageUploader(files[i], this);
							}
						}
					}
			  });
			
			// 태그 js
			const input = document.querySelector('input[name=boardTagName]');
		    let tagify = new Tagify(input); // Tagify 초기화
		    
		    // 태그가 추가되면 이벤트 발생
		    tagify.on('add', function() {
		      console.log(tagify.value); // 입력된 태그 정보 객체(배열)
		      console.log(tagify.value[0].value) // 태그 배열 0번째 객체의 value값 -> 입력한 태그
		    })
		
		    
		    
		    // 파일 업로드 콜백 함수
		    const imageUploader = (file, el) => {
		    //	FormData()는 브라우저에서 제공하는 API이다.
		    // 이 객체를 사용하면 파일과 같은 바이너리 데이터를 포함하여 다양한 형식의 데이터를 multipart/form-data 형식으로 서버에 전송할 수 있다.
		    	let formData = new FormData();
		    // formData 객체에 데이터를 추가하는 코드이다. append 메서드를 사용하여 키-값 쌍을 FormData 객체에 추가한다.
		    	formData.append('file', file);
		    
		    	$.ajax({
		    		data : formData,
		    		type : "POST",
		    		
		    		// url은 이미지 업로드 컨트롤러 메소드 경로
		    		url : "/board/uploadImage",
		    		
		    		// jQuery가 Content-Type 헤더를 자동으로 설정하지 않게 된다.
		    		// 일반적으로 FormData를 사용해 파일을 업로드할 때는 브라우저가 자동으로 multipart/form-data로 설정하므로 false로 설정한다.
		    		contentType : false,
		    		
		    		// processData 속성을 false로 설정하면 jQuery가 데이터를 쿼리 문자열로 자동으로 변환하지 않는다. 
		    		// FormData 객체를 전송할 때는 processData: false로 설정해야 한다.
		    		processData : false,
		    		
		    		// 인코딩 타입을 multipart/form-data으로 지정해준다. 파일 업로드 시 타입을 이처럼 지정해줘야 한다.
		    		enctype : 'multipart/form-data',
		    		
		    		// 요청이 성공적으로 완료되었을 때 호출되는 콜백 함수이다.
		    		// 서버에서 반환된 데이터를 data 파라미터로 받아 처리할 수 있다.
		    		success : function(data){
		    			console.log(data);
		    			$(el).summernote('insertImage', data, function($image){
		    				$image.css('width', "50%");
		    			});
		    		}
		    		
		    	});
		    }
		    
		    
		    
</script>
	</body>
</html>
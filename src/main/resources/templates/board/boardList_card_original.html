<!DOCTYPE html>
<html xmlns:th="http://thymeleaf.org" >
	<head>
		<meta charset="UTF-8">
		<title>술 이야기 메인</title>
		<style type="text/css">
			body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
	        }
	        .container {
	            max-width: 1200px;
	            margin: 0 auto;
	            background-color: white;
	            padding: 20px;
	            border-radius: 8px;
	            box-shadow: 0 0 10px rgba(0,0,0,0.1);
	        }
	        .search-bar {
	            display: flex;
	            margin-bottom: 20px;
	        }
	        .search-bar input[type="text"] {
	            flex-grow: 1;
	            padding: 10px;
	            border: 1px solid #ddd;
	            border-radius: 4px 0 0 4px;
	        }
	        .search-bar button {
	            padding: 10px 20px;
	            background-color: #b8860b;
	            color: white;
	            border: none;
	            border-radius: 0 4px 4px 0;
	            cursor: pointer;
	        }
	        .tag-list {
	            display: flex;
	            flex-wrap: wrap;
	            gap: 10px;
	            margin-bottom: 20px;
	        }
	        .tag {
	            background-color: #f8f8f8;
	            border: 1px solid #ddd;
	            border-radius: 20px;
	            padding: 5px 15px;
	            font-size: 14px;
	            color: #333;
	        }
	        .view-options {
	            display: flex;
	            justify-content: space-between;
	            align-items: center;
	            margin-bottom: 20px;
	        }
	        .view-type a {
	            margin-right: 10px;
	            text-decoration: none;
	            color: #333;
	        }
	        .sort-select select {
	            padding: 5px;
	        }
	        .review-grid {
	            display: grid;
	            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
	            gap: 20px;
	        }
	        .review-card {
	            border: 1px solid #ddd;
	            border-radius: 8px;
	            overflow: hidden;
	        }
	        .review-header {
	            background-color: #f8f8f8;
	            padding: 10px;
	            display: flex;
	            justify-content: space-between;
	        }
	        .review-content {
	            padding: 15px;
	        }
	        .review-footer {
	            background-color: #f8f8f8;
	            padding: 10px;
	            display: flex;
	            justify-content: space-between;
	        }
	        .pagination {
	            display: flex;
	            justify-content: center;
	            margin-top: 20px;
	        }
	        .pagination a {
	            margin: 0 5px;
	            padding: 5px 10px;
	            text-decoration: none;
	            color: #333;
	            border: 1px solid #ddd;
	            border-radius: 4px;
	        }
	        .pagination .active {
	            background-color: #b8860b;
	            color: white;
	        }
		</style>
	</head>
	<body>
		<h1>술 이야기 메인 - 카드</h1>
		<div>캐러셀 자리</div>
		<div>
			<span>카드형</span>
			<a href="/board/listTable">목록형</a>
		</div>
		<a th:href="@{/board/writePage}" th:text="게시글작성"></a>
	<form action="/board/listCard" method="post">
		<input type="hidden" name="searchMethod" value="keywordSearch">
		 <select name="searchCondition">
		 	<option value="all" th:selected="${searchCondition eq 'all'}">전체</option>
		    <option value="boardSubject" th:selected="${searchCondition eq 'boardSubject'}">제목</option>
		    <option value="boardWriter" th:selected="${searchCondition eq 'boardWriter'}">작성자</option>
		 </select>
		 <input type="text" name="searchKeyword" th:value="${searchKeyword}">
		 <!-- 			정렬 선택 hidden input -->
		<input type="hidden" id="orderInputHidden_default"  name="orderSelectBox" th:value="${orderSelectBox}">
		<button>검색</button>
	</form>
	
	<div>
		<form action="/board/searchTag_listCard" method="post">
			<input type="hidden" name="searchMethod" value="tagSearch">
			<div th:each="tag : ${bTagListDistinct}">
				<label th:for="${tag.boardTagName}">[[${tag.boardTagName}]]</label>		
				<input type="checkbox" th:class="tagCheckBox" th:name="tagName" th:value="${tag.boardTagName}" th:id="${tag.boardTagName}" th:checked="${selectedTags != null && #strings.contains(selectedTags, tag.boardTagName)}">
			</div>
<!-- 			체크하지 않았을땐 비활성화(default) -->
			<button type="submit" id="searchButton" disabled>간편검색</button>
<!-- 			정렬 선택 hidden input -->
			<input type="hidden" id="orderInputHidden_tag"  name="orderSelectBox" th:value="${orderSelectBox}">
		</form>
	</div>

<!-- 		정렬 선택 -->
	<select name="orderSelectBox" id="orderSelectBox" onchange="updateHiddenValue();">
		<option value="latest" th:selected="${orderSelectBox eq 'latest'}">최신순</option>
		<option value="viewCount" th:selected="${orderSelectBox eq 'viewCount'}">조회순</option>
		<option value="boardPoint" th:selected="${orderSelectBox eq 'boardPoint'}">별점순</option>
	</select>
		
	<div th:if="${#lists.isEmpty(bList)}">
			<div>NoData</div>
			<a th:href="@{/board/listCard(cp=${p},boardSubject=${boardSubject})}">처음으로</a>
 	</div>	
	<div th:if="${!#lists.isEmpty(bList)}" th:each="board : ${bList}">
		
		<div class="boardOne">
			<div>
				<a th:href="@{/board/detailPage/{boardNo}/{viewStatus}(boardNo=${board.boardNo}, viewStatus='yes')}">게시글 상세</a>
				<div>userId [[${board.userId}]]</div>
				<div>boardPoint [[${board.boardPoint}]]</div>
				<div>boardDate [[${board.boardDate}]]</div>
				<div>viewCount [[${board.viewCount}]]</div>
<!-- 				프로필사진, 회원ID,  -->
			</div>
			<div>
				<div>boardSubject [[${board.boardSubject}]]</div>
				<div>liquorId [[${board.liquorId}]]</div>
			</div>
			<div>
				<div>boardContent</div>
				<div th:utext="${board.boardContent}" class="contentDiv-text"></div>
				
					<div th:each="bFile : ${bFileList}"  th:if="${bFile.boardNo == board.boardNo}">
						<img alt="썸네일이미지" th:src="@{|${bFile.boardFilePath}${bFile.boardFileRename}|}" style="max-width: 300px; max-height: 300px;">
<!-- 						<div class="liquor-image" th:style="${'background-image: url(' + bFile.boardFilePath +'/'+ bFile.boardFileRename+'); background-size: cover; background-position: center;'}"></div> -->
					</div>
				
<!-- 			th문 utext을 이용하여 태그로 이루어진 내용 가져옴 -->
			</div>
			<div id="bTagList">
				<div th:each="tag : ${bTagList}" th:if="${tag.boardNo == board.boardNo}">tag [[${tag.boardTagName}]]</div>
			</div>
		</div>
		<br><br><br>
	</div>
	
	<!-- 	키워드 검색 - 페이징네비 -->
	<div th:unless="${#lists.isEmpty(bList)}" th:if="${searchMethod == 'keywordSearch'}">
		<div>
			<a th:if="${pn.currentPage != 1}"  th:href="@{/board/listCard(cp=1, searchMethod=${searchMethod},  searchCondition=${searchCondition}, searchKeyword=${searchKeyword}, orderSelectBox=${orderSelectBox})}">처음으로</a>
			<a th:if="${pn.getStartNavi() != 1}"  th:href="@{/board/listCard(cp=${pn.prevPage}, searchMethod=${searchMethod},  searchCondition=${searchCondition}, searchKeyword=${searchKeyword}, orderSelectBox=${orderSelectBox})}">이전페이지</a>
			<div th:each="p : ${#numbers.sequence(pn.startNavi, pn.endNavi)}">
				<div th:if="${p == pn.currentPage}">
					<div>
						[[${p}]]
					</div>
				</div>
				<div th:if="${p != pn.currentPage}">
					<a th:href="@{/board/listCard(cp=${p}, searchMethod=${searchMethod},  searchCondition=${searchCondition}, searchKeyword=${searchKeyword}, orderSelectBox=${orderSelectBox})}" th:text="${p}"></a>			
				</div>
			</div>
			<a th:if="${pn.getEndNavi() != pn.getMaxPage()}" th:href="@{/board/listCard(cp=${pn.nextPage}, searchMethod=${searchMethod},  searchCondition=${searchCondition}, searchKeyword=${searchKeyword}, orderSelectBox=${orderSelectBox})}">다음페이지</a>
			<a th:if="${pn.currentPage != pn.maxPage}"  th:href="@{/board/listCard(cp=${pn.maxPage}, searchMethod=${searchMethod},  searchCondition=${searchCondition}, searchKeyword=${searchKeyword}, orderSelectBox=${orderSelectBox})}">마지막으로</a>
			
		</div>
	</div>
	
<!-- 	간편검색 - 페이징네비 -->
	<div th:unless="${#lists.isEmpty(bList)}" th:if="${searchMethod == 'tagSearch'}">
		<div>
			<a th:if="${pn.currentPage != 1}"  href="javascript:void(0)" th:text="처음으로" th:onclick="navigateWithTags(1)"></a>
			<a th:if="${pn.getStartNavi() != 1}"  href="javascript:void(0)" th:text="이전페이지" th:onclick="navigateWithTags([[${pn.prevPage}]])"></a>
			
			
			<div th:each="p : ${#numbers.sequence(pn.startNavi, pn.endNavi)}">
				<div th:if="${p == pn.currentPage}">
					<div>
						[[${p}]]
					</div>
				</div>
				<div th:if="${p != pn.currentPage}">
					<a href="javascript:void(0)" th:text="${p}" th:onclick="navigateWithTags([[${p}]])"></a>
				</div>
			</div>
			<a th:if="${pn.getEndNavi() != pn.MaxPage}"  href="javascript:void(0)" th:text="다음페이지" th:onclick="navigateWithTags([[${pn.nextPage}]])"></a>
			<a th:if="${pn.currentPage != pn.maxPage}"  href="javascript:void(0)" th:text="마지막으로" th:onclick="navigateWithTags([[${pn.maxPage}]])"></a>
			
		</div>
	</div>
		
	</body>
	<script th:inline="javascript">
		document.addEventListener("DOMContentLoaded", function() {
			
	        let contentDivText = document.querySelectorAll(".contentDiv-text");
	        
	        // 텍스트만 출력하기
	        contentDivText.forEach(item => {
	    		item.innerHTML = item.textContent;
	        });
	        
	        
// 	        contentDivImg.forEach(item => {
// 	        	item.innerHTML = item.innerHTML.replace(/<(?!\/?img\b)[^>]*>/gi, ''); // replace(/<\/?[^img][^>]*>/g, '')  // <img> 태그 외의 모든 태그 제거
//  //	        	item.textContent = "";
// 	        	// div 내의 모든 자식 노드를 순회합니다.
			   
// 	        });
		
	// 		간편 검색 - 체크박스 아무것도 체크 안할 때 검색 버튼 비활성화
			let searchButton = document.querySelector("#searchButton");
			let tagCheckBox = document.querySelectorAll(".tagCheckBox");
			
			function updateSearchButtonStatus(){
	// 			Array.from()을 이용해 NodeList를 실제 스크립트 배열로 바꿔줌
	// 			배열의 내장 객체 some() 을 이용하여 조건을 만족시키면 true, 아니면 false를 반환
				let anyChecked = Array.from(tagCheckBox).some(checkBox => checkBox.checked);
				searchButton.disabled = !anyChecked;
			}
			
			tagCheckBox.forEach(checkBox => {
				checkBox.addEventListener('change', updateSearchButtonStatus);
			})
			updateSearchButtonStatus();
			
			
			// 정렬 선택 박스 change 시 hidden input 태그 value 변경
	        
	    });
		
		function updateHiddenValue(){
			const orderSelectBox = document.querySelector('#orderSelectBox');
			const hiddenInput_default = document.querySelector('#orderInputHidden_default');
			const hiddenInput_tag = document.querySelector('#orderInputHidden_tag');
			hiddenInput_default.value = orderSelectBox.value;
			hiddenInput_tag.value = orderSelectBox.value;
			
			console.log(hiddenInput_tag.value);
		}
		
		updateHiddenValue();
		
		function navigateWithTags(page) {
		    const selectedTags = [];
		    // 체크된 체크박스의 값을 배열에 추가
		    document.querySelectorAll('input[name="tagName"]:checked').forEach((checkbox) => {
		        selectedTags.push(checkbox.value);
		    });
		    // orderSelectBox 값을 가져오기
		    const orderSelectBox = document.getElementById('orderSelectBox').value;
		    
		    // URL 생성
		    let url = `/board/searchTag_listCard?cp=${page}&searchMethod=tagSearch&orderSelectBox=${orderSelectBox}`;
		    // 선택된 태그들을 URL에 추가
		    if (selectedTags.length > 0) {
		        url += '&tagName=' + selectedTags.join(',');
		    }
		    
		    // 페이지 이동
		    window.location.href = url;
		}

		
		
		</script>
</html>